<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

    <!-- cache based configuration service -->
    <bean id="configurationService"
        class="org.ikasan.flow.configuration.service.ConfiguredResourceConfigurationService">
        <constructor-arg>
            <bean class="org.ikasan.flow.configuration.dao.ConfigurationCacheImpl" />
        </constructor-arg>
        <constructor-arg>
            <bean class="org.ikasan.flow.configuration.dao.ConfigurationCacheImpl" />
        </constructor-arg>
    </bean>

    <!-- cache based configuration service -->
    <bean id="recoveryManagerFactory" class="org.ikasan.recovery.RecoveryManagerFactory">
        <constructor-arg ref="scheduler" />
        <constructor-arg ref="scheduledJobFactory" />
    </bean>

    <bean id="scheduler"
        class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetObject" ref="schedulerFactory" />
        <property name="targetMethod" value="getScheduler" />
    </bean>

    <bean id="schedulerFactory"
        class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetClass">
            <value>org.ikasan.scheduler.SchedulerFactory</value>
        </property>
        <property name="targetMethod">
            <value>getInstance</value>
        </property>
    </bean>

    <bean id="scheduledJobFactory"
        class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="targetClass">
            <value>org.ikasan.scheduler.CachingScheduledJobFactory</value>
        </property>
        <property name="targetMethod">
            <value>getInstance</value>
        </property>
    </bean>

    <bean id="flowElementInvoker" class="org.ikasan.flow.visitorPattern.VisitingFlowElementInvoker">
        <constructor-arg>
		    <bean id="replicationFactory"
		        class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		        <property name="targetClass">
		            <value>org.ikasan.flow.event.DefaultReplicationFactory</value>
		        </property>
		        <property name="targetMethod">
		            <value>getInstance</value>
		        </property>
		    </bean>
        </constructor-arg>
    </bean>

</beans>